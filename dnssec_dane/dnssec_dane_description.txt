////////////////////////////////////////////////////////////////////////////////
//                                                                            //
//  Copyright (C) 2011-2014, Armory Technologies, Inc.                        //
//  Distributed under the GNU Affero General Public License (AGPL v3)         //
//  See LICENSE or http://www.gnu.org/licenses/agpl.html                      //
//                                                                            //
////////////////////////////////////////////////////////////////////////////////

This DNSSEC/DANE code is meant to be a proof of concept of an in-progress
project. The code will continue to shift over time.

The getdns API (http://www.vpnc.org/getdns-api/) has a reference implementation
(https://github.com/getdnsapi/getdns) and reference Python bindings
(https://github.com/getdnsapi/getdns-python-bindings) used to create an
easy-to-use API that provides access to DNS and DNSSEC. The following is an
in-order list of the material one will need to get both the getdns reference
code and the getdns Python bindings to work. The directions given may not be
needed for everybody; they're for people building everything from source. (Linux
distros may already have some libraries built in or offered in pre-built
packages.) In addition, some of the libraries may require extra packages. This
file may be missing some of the packages!

1)libtool  (https://www.gnu.org/software/libtool/)
Ubuntu package: libtool
-Binaries are required by Expat - Can just install a pre-built package

2)makeinfo  (https://www.gnu.org/software/texinfo/)
Ubuntu package: texinfo
-Binaries are required by libcheck - Can just install a pre-built package

3)libexpat  (http://expat.sourceforge.net/)
Ubuntu package: libexpat1
OR
-Run buildconf.sh if you did a CVS checkout
-./configure
-make
-sudo make install

4)libcheck  (http://check.sourceforge.net/)
Optional - Used only to run getdns tests
Ubuntu package: None
-./configure
-make
-make check
-sudo make install

5)OpenSSL  (https://www.openssl.org/)
Ubuntu package: openssl
OR
-If building your own OpenSSL, placing everything in /usr/local instead of
 /usr/local/ssl may make things go more smoothly later.
-CFLAGS="-fPIC"
-./config shared no-idea
-make depend
-make
-make test
-sudo make install

6)libidn  (https://www.gnu.org/software/libidn/)
Ubuntu package: None
-./configure
-make
-make install

7)libevent  (http://libevent.org/)
Ubuntu package: libevent-dev
OR
-buildconf.sh ONLY if you did a CVS checkout
-./configure
-./make
-./sudo make install

8)ldns  (https://www.nlnetlabs.nl/projects/ldns/)
Ubuntu package: libldns-dev
OR
-./configure --with-examples --with-drill
-make
-sudo make install

9)libunbound  (https://unbound.net/)
Ubuntu package: libunbound-dev
OR
-autogen.sh ONLY if you did a Git checkout
-./configure --with-ldns --with-libevent --with-ssl
-make
-make test
-sudo make install

10)Run "sudo ldconfig"  (Needed for getdns tests)

11)getdns  (https://github.com/getdnsapi/getdns)
Ubuntu package (as of 15.04): getdns
OR
-autoreconf --install
-./configure --with-libevent
-make CFLAGS="-I/usr/local/include -I/usr/local/include -I/usr/local/include -I/usr/local/ssl/include -I."
-make test CFLAGS="-I/usr/local/include -I/usr/local/include -I/usr/local/include -I/usr/local/ssl/include -I../"
-sudo make install

12)unbound-anchor  (https://www.unbound.net/documentation/unbound-anchor.html)
Ubuntu package: unbound-anchor
-Binaries are required by getdns in order to support DNSSEC - Can just install a
 pre-built package
-sudo mkdir /etc/unbound
-sudo unbound-anchor -a "/etc/unbound/getdns-root.key"

13)Run "sudo ldconfig"  (Possibly needed for getdns Python bindings)

14)setuptools  (https://pypi.python.org/pypi/setuptools)
Ubuntu package: python-setuptools
OR
-Optional - Required by the optional "M2Crypto" Python package
-wget https://bootstrap.pypa.io/ez_setup.py -O - | sudo python

15)M2Crypto  (http://chandlerproject.org/Projects/MeTooCrypto - https://github.com/martinpaljak/M2Crypto)
Ubuntu package: python-m2crypto
OR
-Edit setup.py such that "opensslIncludeDir" & "opensslLibraryDir" point to the
 correct directories.
-sudo python setup.py install

16)getdns-python-bindings  (https://github.com/getdnsapi/getdns-python-bindings)
Ubuntu package: None
-Download the "develop" branch from Github.
-If OpenSSL was compiled from source, edit setup.py such that
 "include_dirs = [ '/usr/local/include', '/usr/local/ssl/include' ],"
-sudo python setup.py install
-If compilation fails, download the "v0.1.3" branch from Github and repeat the
 previous compilation instructions.




#######
Based on the above notes, here's Alan's successful command history to get it 
all working on Linux Mint 17.  Should work on Ubuntu 14.04, 14.10 as well.
#######

sudo apt-get install libtool texinfo libexpat1 libevent-dev libldns-dev libunbound-dev unbound-anchor python-setuptools python-m2crypto autoconf

wget http://sourceforge.net/projects/check/files/check/0.9.14/check-0.9.14.tar.gz
tar -xzf check-0.9.14.tar.gz
cd check-0.9.14
./configure
make
make check
sudo make install

cd ..
wget http://ftp.gnu.org/gnu/libidn/libidn-1.30.tar.gz
tar -zxf libidn-1.30.tar.gz
cd libidn-1.30
./configure
make
sudo make install

cd ..
git clone https://github.com/getdnsapi/getdns
cd getdns
autoreconf --install
./configure --with-libevent
make CFLAGS="-I/usr/local/include -I/usr/local/include -I/usr/local/include -I/usr/local/ssl/include -I."
sudo make install

sudo ldconfig  # necessary?

cd ..
git clone https://github.com/getdnsapi/getdns-python-bindings
cd getdns-python-bindings/
git checkout develop
sudo python setup.py install

cd ..
git clone https://github.com/etotheipi/BitcoinArmory.git
cd BitcoinArmory
git checkout wallet2.0-dns
cd dnssec_dane
python getDANERec.py chris@payments.verisignlabs.com m
